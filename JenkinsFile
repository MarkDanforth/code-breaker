node {
    stage('Prepare') {
        git 'https://github.com/MarkDanforth/code-breaker.git'
        sh 'npm install'
    }
    stage('Build') {        
        sh './node_modules/@angular/cli/bin/ng build --prod --aot=false'
        sh 'git rev-parse HEAD | cut -c1-4 > ./dist/VERSION.txt'
    }
    stage('Deploy') {
        sshagent(['frank']) {
        sh 'ssh mark@cursedbanana.westeurope.cloudapp.azure.com rm -rf /home/mark/dist/*'
        sh 'scp -r dist mark@cursedbanana.westeurope.cloudapp.azure.com:/home/mark/'
        }
    }
}